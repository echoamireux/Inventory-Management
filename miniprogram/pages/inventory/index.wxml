<!--pages/inventory/index.wxml-->
<view class="container">
  <!-- 顶部搜索与筛选 -->
  <view class="sticky-top bg-white z-index-10">
    <!-- 搜索栏 + 导出按钮 -->
    <view class="flex-row items-center px-3">
      <view class="flex-1">
        <van-search
          value="{{ searchVal }}"
          placeholder="搜索 名称 / 料号 / 批号 / 供应商"
          shape="round"
          bind:search="onSearch"
          bind:change="onSearchChange"
          bind:clear="onSearch"
        />
      </view>
      <!-- 导出按钮 (圆形) -->
      <view class="export-btn-circle" bindtap="onExport">
        <van-icon name="description" color="#1989fa" size="18px" />
      </view>
    </view>

    <!-- Tabs -->
    <van-tabs active="{{ activeTab }}" bind:change="onTabChange" color="#1989fa">
      <van-tab title="全部" />
      <van-tab title="化材" />
      <van-tab title="膜材" />
    </van-tabs>

      <!-- 预警筛选提示 (Notice Bar) -->
      <van-notice-bar
        wx:if="{{ isExpiryFilter }}"
        mode="closeable"
        left-icon="info-o"
        text="正在筛选：即将过期的物料 (30天内)"
        bind:close="clearFilter"
        color="#ed6a0c"
        background="#fffbe8"
      />
  </view>

      <!-- 列表内容 -->
      <view class="list-container">
        <block wx:if="{{ list.length > 0 }}">
          <!-- 使用统一组件 -->
          <material-list-item
            wx:for="{{ list }}"
            wx:key="product_code"
            item="{{ item }}"
            showCategory="{{ false }}"
            bind:tap="goToDetail"
            data-index="{{ index }}"
          />
        </block>
        <van-empty wx:else description="暂无库存数据" />
      </view>

  <view wx:if="{{ loading }}" class="text-center p-10">
    <van-loading size="24px">加载中...</van-loading>
  </view>
  <view wx:if="{{ isEnd && list.length > 0 }}" class="text-center p-10 text-secondary text-xs">
    - 到底了 -
  </view>

  <van-dialog id="van-dialog" />
</view>
