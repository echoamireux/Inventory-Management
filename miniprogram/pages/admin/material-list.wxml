<!--pages/admin/material-list.wxml-->
<view class="container pb-20">
  <!-- 搜索栏 -->
  <view class="search-transparent">
    <van-search
        value="{{ searchVal }}"
        placeholder="搜索产品代码/名称/供应商"
        shape="round"
        bind:search="onSearch"
        bind:clear="onSearchClear"
        bind:change="onSearch"
    />
  </view>

  <!-- 顶部统计与操作按钮 -->
  <view class="flex-row justify-between items-center px-20 py-10">
    <view class="text-secondary text-sm flex-shrink-0 font-bold ml-4">{{ total }} 种</view>
    <view class="flex-row items-center">
      <van-button
        type="default"
        size="small"
        round
        icon="upgrade"
        custom-style="padding: 0 12px; margin-right: 8px; min-width: 70px;"
        bind:click="onImport"
      >
        导入
      </van-button>
      <van-button
        type="primary"
        size="small"
        round
        icon="plus"
        custom-style="padding: 0 12px; min-width: 70px;"
        bind:click="onAdd"
      >
        新增
      </van-button>
    </view>
  </view>

  <!-- 物料列表 -->
  <view class="px-16" wx:if="{{ list.length > 0 }}">
    <block wx:for="{{ list }}" wx:key="_id">
      <view class="material-card mb-12">
        <view class="flex-row justify-between items-start">
          <!-- 左侧信息 -->
          <view class="flex-1">
            <view class="flex-row items-center mb-6">
              <text class="text-lg font-bold text-primary mr-10">{{ item.product_code }}</text>
              <van-tag
                type="{{ item.category === 'chemical' ? 'primary' : 'success' }}"
                plain
                size="medium"
              >
                {{ item.category === 'chemical' ? '化材' : '膜材' }}
              </van-tag>
            </view>
            <view class="text-base text-main mb-4">{{ item.material_name }}</view>
            <view class="flex-row items-center text-sm text-secondary">
              <text wx:if="{{ item.supplier }}" class="mr-16">{{ item.supplier }}</text>
              <text wx:if="{{ item.default_unit }}">默认单位: {{ item.default_unit }}</text>
            </view>
          </view>

          <!-- 右侧操作按钮：强制不许压缩，且给最大宽度限制 -->
          <view class="flex-row items-center flex-shrink-0" style="max-width: 40%;">
            <van-button
              type="primary"
              size="mini"
              plain
              round
              custom-style="width: auto; padding: 0 12px; margin-right: 8px; white-space: nowrap;"
              data-id="{{ item._id }}"
              bind:click="onEdit"
            >
              编辑
            </van-button>
            <van-button
              type="danger"
              size="mini"
              plain
              round
              custom-style="width: auto; padding: 0 12px; white-space: nowrap;"
              data-id="{{ item._id }}"
              bind:click="onArchive"
            >
              归档
            </van-button>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 空状态 -->
  <van-empty
    wx:if="{{ !loading && list.length === 0 }}"
    description="暂无物料数据"
  >
    <van-button type="primary" size="small" round bind:click="onAdd">
      添加第一个物料
    </van-button>
  </van-empty>

  <!-- 加载状态 -->
  <view wx:if="{{ loading }}" class="flex-row justify-center py-20">
    <van-loading type="spinner">加载中...</van-loading>
  </view>

  <!-- 到底提示 -->
  <view wx:if="{{ isEnd && list.length > 0 }}" class="text-center text-sm text-secondary py-20">
    没有更多了
  </view>

  <!-- Toast & Dialog -->
  <van-toast id="van-toast" />
  <van-dialog id="van-dialog" />
</view>
